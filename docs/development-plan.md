# План разработки проекта Juris

## Этап 1: Подготовка и настройка проекта (1-2 недели)

### 1.1 Настройка окружения разработки

- [x] Установка Node.js, npm/yarn
- [x] Установка React Native CLI и Expo CLI
- [x] Настройка IDE (VS Code + расширения)
- [ ] Установка Android Studio / Xcode для эмуляторов
- [x] Настройка Git репозитория

### 1.2 Инициализация проектов

- [x] Создание React Native проекта с Expo
- [x] Создание Node.js backend проекта
- [x] Настройка TypeScript для обоих проектов
- [x] Настройка eslint, prettier
- [x] Создание базовой структуры папок

### 1.3 Настройка базы данных

- [x] Установка PostgreSQL локально или Docker
- [x] Установка PostGIS расширения
- [x] Настройка Redis
- [x] Создание базовых схем БД

## Этап 2: MVP Backend ✅ ЗАВЕРШЕН (2-3 недели)

### 2.1 Базовая архитектура backend

- [x] Настройка Express.js с TypeScript
- [x] Настройка подключения к PostgreSQL (прямые SQL запросы)
- [x] Базовая структура роутов
- [x] Middleware для логирования и обработки ошибок
- [x] Настройка переменных окружения

### 2.2 Система аутентификации

- [x] Модель пользователя в БД
- [x] Регистрация и авторизация (JWT)
- [x] Middleware для защиты роутов
- [x] Базовая валидация данных

### 2.3 Базовые API endpoints

```
POST /api/auth/register ✅
POST /api/auth/login ✅
GET  /api/auth/profile ✅
PUT  /api/auth/profile ✅

GET  /api/teams ✅
POST /api/teams ✅
PUT  /api/teams/:id ✅
GET  /api/teams/:id ✅
POST /api/teams/:id/join ✅

GET  /api/territories ✅
POST /api/territories ✅
GET  /api/territories/:id ✅
GET  /api/territories/nearby ✅

POST /api/captures ✅
GET  /api/captures/active ✅
GET  /api/captures/history ✅
DELETE /api/captures/:id ✅
```

### 2.4 Геопространственная логика

- [x] Создание таблиц для территорий с PostGIS
- [x] Функции для определения пересечения координат с территориями
- [x] API для получения ближайших территорий
- [x] Логика захвата территорий
- [x] Система очков за захват
- [x] Автоматическая деактивация предыдущих захватов
- [x] Проверка расположения пользователя (50м от территории)
- [x] Real-time отслеживание захватов

## Этап 3: MVP Frontend (2-3 недели)

### 3.1 Базовая структура приложения

- [x] Настройка React Navigation
- [x] Создание основных экранов (Map, Run, Team, Profile)
- [x] Базовые компоненты UI
  - [x] Button компонент с вариантами
  - [x] MapComponent с поддержкой территорий
  - [x] Минималистичная навигация
  - [x] Система темизации
  - [x] LoadingOverlay компонент
  - [x] Feedback система с анимациями
- [x] Настройка состояния приложения
  - [x] Установка Zustand для управления состоянием
  - [x] Настройка React Query для API запросов
  - [x] Базовая структура store
  - [x] FeedbackContext для уведомлений
- [x] Оптимизация производительности
  - [x] Оптимизированный хук для геолокации
  - [x] Эффективное управление подписками
  - [x] Правильная обработка жизненного цикла

### 3.2 Система аутентификации

- [x] Настройка API клиента с axios
- [x] Базовая структура авторизации
  - [x] Хранение токенов (AsyncStorage)
  - [x] Автоматическая инъекция токенов
  - [x] Обработка истечения токена
- [x] Экран входа
- [x] Экран регистрации
- [x] Восстановление пароля
- [x] Профиль пользователя
- [x] Автоматический вход при наличии токена
- [x] Базовая обработка ошибок аутентификации

### 3.3 Интеграция карт и геолокации

- [x] Подключение react-native-maps
- [x] Настройка разрешений для геолокации
- [x] Отображение текущей позиции пользователя
- [x] Базовая стилизация карты
- [x] ✅ Интеграция с territories API для отображения территорий
- [x] ✅ MapComponent с поддержкой GeoJSON полигонов
- [x] ✅ Функциональность захвата территорий в UI
- [ ] ⚠️ Тестирование отображения территорий на карте
- [ ] Визуализация маршрута бега

### 3.4 Базовая функциональность

- [x] Базовый интерфейс профиля пользователя
- [x] Просмотр списка команд
- [x] ✅ API сервисы для всех endpoints (auth, teams, territories, captures)
- [x] ✅ Zustand stores для управления состоянием
- [x] ✅ Компонент тестирования API подключения
- [ ] Присоединение к команде
- [ ] Просмотр захваченных территорий
- [ ] ⚠️ Тестирование интеграции с Backend API (в процессе)
- [ ] Обработка оффлайн режима

## Этап 4: Геолокация и Real-time ✅ ЗАВЕРШЕН (Backend) (2 недели)

### 4.1 Отслеживание геолокации

- [x] Запрос разрешений на геолокацию
- [x] Непрерывное отслеживание позиции
- [x] Определение входа в территорию
- [x] Отправка координат на сервер

### 4.2 Real-time функциональность

- [x] Настройка Socket.io на backend (или REST API)
- [x] Подключение к API в React Native
- [x] Real-time обновления позиций игроков
- [x] Уведомления о захвате территорий

### 4.3 Система захвата территорий

- [x] Логика определения успешного захвата
- [x] Условия для захвата (время нахождения, количество игроков)
- [x] Визуальная обратная связь в приложении
- [x] История захватов

## Этап 5: Расширенная функциональность (3-4 недели)

### 5.1 Система команд

- [ ] Создание команд
- [ ] Приглашения в команду
- [ ] Роли в команде (лидер, участник)
- [ ] Статистика команды
- [ ] Чат команды

### 5.2 Геймификация

- [ ] Система очков и уровней
- [ ] Достижения и бейджи
- [ ] Рейтинги команд и игроков
- [ ] Ежедневные/недельные задания

### 5.3 Партнерские заведения

- [ ] Добавление кафе и ресторанов в БД
- [ ] Привязка заведений к территориям
- [ ] Система скидок и предложений
- [ ] QR-коды для активации скидок

## Этап 6: Полировка и оптимизация (2-3 недели)

### 6.1 Производительность

- [ ] Оптимизация запросов к БД
- [ ] Кеширование данных (Redis)
- [ ] Оптимизация real-time обновлений
- [ ] Сжатие изображений и ресурсов

### 6.2 UX/UI улучшения

- [x] Минималистичный дизайн интерфейса
- [ ] Анимации и переходы
- [x] Базовый дизайн карты
- [x] Система темизации с поддержкой тем
- [ ] Улучшенная визуализация бега
- [ ] Оффлайн режим (базовый)
- [ ] Улучшенные состояния загрузки
- [ ] Тактильная обратная связь

### 6.3 Тестирование

- [ ] Unit тесты для критической логики
- [ ] Integration тесты для API
- [ ] E2E тесты основных сценариев
- [ ] Тестирование на реальных устройствах

## Этап 7: Деплой и запуск (1-2 недели)

### 7.1 Подготовка к продакшну

- [ ] Настройка production окружения
- [ ] Настройка CI/CD
- [ ] Конфигурация серверов
- [ ] Настройка мониторинга

### 7.2 Деплой

- [ ] Деплой backend на Heroku/AWS
- [ ] Настройка production БД
- [ ] Сборка и публикация мобильного приложения
- [ ] Настройка доменного имени и SSL

### 7.3 Мониторинг и поддержка

- [ ] Настройка логирования
- [ ] Мониторинг ошибок (Sentry)
- [ ] Аналитика использования
- [ ] Обратная связь от пользователей

## Приоритеты для MVP

### Завершено:

1. ✅ **Базовая структура приложения**
   - Навигация
   - Основные экраны
   - Базовые компоненты
2. ✅ **Минималистичный UI**
   - Система темизации
   - Базовые компоненты
   - Адаптивный дизайн
3. ✅ **Базовая интеграция карт**
   - Отображение карты
   - Геолокация пользователя
   - Базовая стилизация
4. ✅ **Система аутентификации**
   - Регистрация и вход
   - Восстановление пароля
   - Профиль пользователя
   - Управление токенами
   - Обработка ошибок
5. ✅ **Полноценный Backend API**
   - JWT аутентификация
   - Управление командами
   - Геопространственные территории (PostGIS)
   - Система захватов с real-time логикой
   - Проверка геолокации и расстояний
   - Автоматическая система очков
   - История захватов и статистика
6. ✅ **Геопространственная система**
   - PostGIS интеграция
   - Поиск ближайших территорий
   - Валидация расположения пользователя
   - Автоматические перевороты территорий
   - Система деактивации захватов

### Критически важно (Следующие шаги):

1. **Frontend интеграция с Backend API**

   - Подключение к созданным endpoints
   - Аутентификация во frontend
   - Синхронизация данных команд
   - Обработка ошибок и loading states
   - Интеграция с токенами JWT

2. **Отображение территорий на карте**

   - Визуализация геополигонов
   - Цветовое кодирование по командам
   - Интерактивные элементы карты
   - Real-time обновления захватов
   - Кастомные маркеры

3. **Функциональность захватов в приложении**

   - Интеграция с captures API
   - Проверка геолокации пользователя
   - Уведомления о захватах
   - История захватов команды
   - Статистика игрока

4. **Функциональность бега и трекинга**
   - Трекинг маршрута движения
   - Валидация скорости перемещения
   - Визуализация прогресса на карте
   - Отслеживание дистанции

### Можно отложить на версию 2.0:

1. Сложная геймификация
2. Партнерские заведения
3. Продвинутый чат команды
4. Сложные анимации
5. Полноценный оффлайн режим
6. Расширенная аналитика бега

## Временные рамки

**Общее время разработки MVP: 8-12 недель**

- ✅ Подготовка: 1-2 недели (завершено)
- ✅ Backend MVP: 2-3 недели (завершено)
- ⚠️ Frontend MVP: 2-3 недели (в процессе - требуется интеграция с API)
- Real-time функции: 1-2 недели
- Геолокация и карты: 1-2 недели
- Оптимизация и тестирование: 1-2 недели
- Деплой: 1 неделя

**Текущий статус:** Backend полностью готов, требуется интеграция frontend с API endpoints и завершение функций карт.

- Real-time функции: 2 недели
- Тестирование и деплой: 1-2 недели

## Команда разработки

### Минимальная команда:

- 1 Fullstack разработчик (или Frontend + Backend)
- 1 UI/UX дизайнер (может быть на аутсорсе)

### Оптимальная команда:

- 1 Backend разработчик
- 1 React Native разработчик
- 1 UI/UX дизайнер
- 1 DevOps инженер (для деплоя)

## Следующие шаги

### Немедленные приоритеты:

1. **Трекинг бега**

   - Точный трекинг маршрута
   - Проверка скорости
   - Real-time обновления
   - Визуализация прогресса

2. **Система территорий**

   - Отображение на карте
   - Логика захвата
   - Уведомления о захвате
   - Командный прогресс

3. **Улучшение UX бега**

   - Точный трекинг маршрута
   - Визуализация прогресса
   - Статистика в реальном времени
   - Энергетическая система

4. **Доработка UI**

   - Формы входа/регистрации
   - Улучшенные состояния загрузки
   - Обратная связь при действиях
   - Анимации переходов

5. **Оптимизация производительности**
   - Оптимизация ре-рендеринга
   - Эффективное использование памяти
   - Оптимизация карты
   - Кэширование данных

Этот план адаптирован с учетом текущего прогресса и фокусируется на интеграции уже созданных компонентов с бэкендом и улучшении пользовательского опыта.
