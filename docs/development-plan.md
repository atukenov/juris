# План разработки проекта Juris

## Этап 1: Подготовка и настройка проекта (1-2 недели)

### 1.1 Настройка окружения разработки

- [x] Установка Node.js, npm/yarn
- [x] Установка React Native CLI и Expo CLI
- [x] Настройка IDE (VS Code + расширения)
- [ ] Установка Android Studio / Xcode для эмуляторов
- [x] Настройка Git репозитория

### 1.2 Инициализация проектов

- [x] Создание React Native проекта с Expo
- [x] Создание Node.js backend проекта
- [x] Настройка TypeScript для обоих проектов
- [x] Настройка eslint, prettier
- [x] Создание базовой структуры папок

### 1.3 Настройка базы данных

- [x] Установка PostgreSQL локально или Docker
- [x] Установка PostGIS расширения
- [x] Настройка Redis
- [x] Создание базовых схем БД

## Этап 2: MVP Backend ✅ ЗАВЕРШЕН (2-3 недели)

### 2.1 Базовая архитектура backend

- [x] Настройка Express.js с TypeScript
- [x] Настройка подключения к PostgreSQL (прямые SQL запросы)
- [x] Базовая структура роутов
- [x] Middleware для логирования и обработки ошибок
- [x] Настройка переменных окружения

### 2.2 Система аутентификации

- [x] Модель пользователя в БД
- [x] Регистрация и авторизация (JWT)
- [x] Middleware для защиты роутов
- [x] Базовая валидация данных

### 2.3 Базовые API endpoints

```
POST /api/auth/register ✅
POST /api/auth/login ✅
GET  /api/auth/profile ✅
PUT  /api/auth/profile ✅

GET  /api/teams ✅
POST /api/teams ✅
PUT  /api/teams/:id ✅
GET  /api/teams/:id ✅
POST /api/teams/:id/join ✅

GET  /api/territories ✅
POST /api/territories ✅
GET  /api/territories/:id ✅
GET  /api/territories/nearby ✅

POST /api/captures ✅
GET  /api/captures/active ✅
GET  /api/captures/history ✅
DELETE /api/captures/:id ✅
```

### 2.4 Геопространственная логика

- [x] Создание таблиц для территорий с PostGIS
- [x] Функции для определения пересечения координат с территориями
- [x] API для получения ближайших территорий
- [x] Логика захвата территорий
- [x] Система очков за захват
- [x] Автоматическая деактивация предыдущих захватов
- [x] Проверка расположения пользователя (50м от территории)
- [x] Real-time отслеживание захватов

## Этап 3: MVP Frontend ✅ ЗАВЕРШЕН (95%) (2-3 недели)

### 3.1 Базовая структура приложения ✅

- [x] Настройка React Navigation
- [x] Создание основных экранов (Map, Run, Team, Profile)
- [x] Базовые компоненты UI
  - [x] Button компонент с вариантами
  - [x] MapComponent с поддержкой территорий
  - [x] Минималистичная навигация
  - [x] Система темизации
  - [x] LoadingOverlay компонент
  - [x] Feedback система с анимациями
- [x] Настройка состояния приложения
  - [x] Установка Zustand для управления состоянием
  - [x] Настройка React Query для API запросов
  - [x] Базовая структура store
  - [x] FeedbackContext для уведомлений
- [x] Оптимизация производительности
  - [x] Оптимизированный хук для геолокации
  - [x] Эффективное управление подписками
  - [x] Правильная обработка жизненного цикла

### 3.2 Система аутентификации ✅

- [x] Настройка API клиента с axios
- [x] Базовая структура авторизации
  - [x] Хранение токенов (AsyncStorage)
  - [x] Автоматическая инъекция токенов
  - [x] Обработка истечения токена
- [x] Экран входа
- [x] Экран регистрации
- [x] Восстановление пароля
- [x] Профиль пользователя
- [x] Автоматический вход при наличии токена
- [x] Базовая обработка ошибок аутентификации
- [x] ✅ Полная интеграция с Backend API
- [x] ✅ Валидация форм и пользовательские сообщения
- [x] ✅ Условная навигация Auth/Main

### 3.3 Интеграция карт и геолокации

- [x] Подключение react-native-maps
- [x] Настройка разрешений для геолокации
- [x] Отображение текущей позиции пользователя
- [x] Базовая стилизация карты
- [x] ✅ Интеграция с territories API для отображения территорий
- [x] ✅ MapComponent с поддержкой GeoJSON полигонов
- [x] ✅ Функциональность захвата территорий в UI
- [x] ✅ MapScreen с полной интеграцией territory и capture API
- [x] ✅ Автоматическая загрузка ближайших территорий
- [x] ✅ Веб-совместимая версия для разработки
- [ ] Native карты для мобильных устройств (react-native-maps полигоны)
- [ ] Визуализация маршрута бега

### 3.4 Базовая функциональность ✅

- [x] Базовый интерфейс профиля пользователя
- [x] Просмотр списка команд
- [x] ✅ API сервисы для всех endpoints (auth, teams, territories, captures)
- [x] ✅ Zustand stores для управления состоянием
- [x] ✅ Компонент тестирования API подключения
- [x] ✅ TeamScreen с полной интеграцией teams API
- [x] ✅ Создание, присоединение и покидание команд
- [x] ✅ Отображение статистики команды в реальном времени
- [x] ✅ Pull-to-refresh функциональность
- [x] Просмотр захваченных территорий
- [x] ✅ Полная интеграция с Backend API
- [ ] Обработка оффлайн режима

### 3.5 Продвинутая система бега ✅ НОВОЕ!

- [x] ✅ RunScreen с полным трекингом активности
- [x] ✅ Мониторинг расстояния, времени и скорости в реальном времени
- [x] ✅ Валидация скорости для захвата территорий (6-25 км/ч)
- [x] ✅ Интеграция с территориальной системой во время бега
- [x] ✅ Детализированная статистика с форматированием
- [x] ✅ Игровая механика с энергетической системой
- [x] ✅ Захват территорий во время активного бега
- [ ] Трекинг маршрута с сохранением пути
- [ ] Визуализация пройденного расстояния на карте

## Этап 4: Геолокация и Real-time ✅ ЗАВЕРШЕН (Backend) (2 недели)

### 4.1 Отслеживание геолокации

- [x] Запрос разрешений на геолокацию
- [x] Непрерывное отслеживание позиции
- [x] Определение входа в территорию
- [x] Отправка координат на сервер

### 4.2 Real-time функциональность

- [x] Настройка Socket.io на backend (или REST API)
- [x] Подключение к API в React Native
- [x] Real-time обновления позиций игроков
- [x] Уведомления о захвате территорий

### 4.3 Система захвата территорий

- [x] Логика определения успешного захвата
- [x] Условия для захвата (время нахождения, количество игроков)
- [x] Визуальная обратная связь в приложении
- [x] История захватов

## Этап 5: Расширенная функциональность (3-4 недели)

### 5.1 Продвинутая система команд ✅ ЗАВЕРШЕНО

- [x] Создание команд с предопределенными цветами
- [x] Система владения (один владелец = одна команда)
- [x] Передача владения с системой подтверждения
- [x] Настройки команды только для владельцев
- [x] Валидация выхода из команды
- [x] База данных для отслеживания передач владения
- [x] UI для управления передачей прав
- [x] Уведомления о запросах передачи владения
- [x] Система принятия/отклонения передач
- [x] Роли в команде (владелец, участник)
- [x] Статистика команды
- [ ] Чат команды

### 5.2 Геймификация

- [ ] Система очков и уровней
- [ ] Достижения и бейджи
- [ ] Рейтинги команд и игроков
- [ ] Ежедневные/недельные задания

### 5.3 Партнерские заведения

- [ ] Добавление кафе и ресторанов в БД
- [ ] Привязка заведений к территориям
- [ ] Система скидок и предложений
- [ ] QR-коды для активации скидок

## Этап 6: Полировка и оптимизация (2-3 недели)

### 6.1 Производительность

- [ ] Оптимизация запросов к БД
- [ ] Кеширование данных (Redis)
- [ ] Оптимизация real-time обновлений
- [ ] Сжатие изображений и ресурсов

### 6.2 UX/UI улучшения

- [x] Минималистичный дизайн интерфейса
- [ ] Анимации и переходы
- [x] Базовый дизайн карты
- [x] Система темизации с поддержкой тем
- [ ] Улучшенная визуализация бега
- [ ] Оффлайн режим (базовый)
- [ ] Улучшенные состояния загрузки
- [ ] Тактильная обратная связь

### 6.3 Тестирование

- [ ] Unit тесты для критической логики
- [ ] Integration тесты для API
- [ ] E2E тесты основных сценариев
- [ ] Тестирование на реальных устройствах

## Этап 7: Деплой и запуск (1-2 недели)

### 7.1 Подготовка к продакшну

- [ ] Настройка production окружения
- [ ] Настройка CI/CD
- [ ] Конфигурация серверов
- [ ] Настройка мониторинга

### 7.2 Деплой

- [ ] Деплой backend на Heroku/AWS
- [ ] Настройка production БД
- [ ] Сборка и публикация мобильного приложения
- [ ] Настройка доменного имени и SSL

### 7.3 Мониторинг и поддержка

- [ ] Настройка логирования
- [ ] Мониторинг ошибок (Sentry)
- [ ] Аналитика использования
- [ ] Обратная связь от пользователей

## Приоритеты для MVP

### Завершено:

1. ✅ **Базовая структура приложения**
   - Навигация
   - Основные экраны
   - Базовые компоненты
2. ✅ **Минималистичный UI**
   - Система темизации
   - Базовые компоненты
   - Адаптивный дизайн
3. ✅ **Базовая интеграция карт**
   - Отображение карты
   - Геолокация пользователя
   - Базовая стилизация
4. ✅ **Система аутентификации**
   - Регистрация и вход
   - Восстановление пароля
   - Профиль пользователя
   - Управление токенами
   - Обработка ошибок
5. ✅ **Полноценный Backend API**
   - JWT аутентификация
   - Управление командами
   - Геопространственные территории (PostGIS)
   - Система захватов с real-time логикой
   - Проверка геолокации и расстояний
   - Автоматическая система очков
   - История захватов и статистика
6. ✅ **Геопространственная система**
   - PostGIS интеграция
   - Поиск ближайших территорий
   - Валидация расположения пользователя
   - Автоматические перевороты территорий
   - Система деактивации захватов
7. ✅ **НОВОЕ! Полная Frontend-Backend интеграция**
   - Аутентификация с формами валидации
   - Система команд с real-time обновлениями
   - MapScreen с территориями и захватами
   - RunScreen с продвинутым трекингом
   - API интеграция для всех компонентов
   - Zustand stores подключены к backend
   - Веб-совместимая версия для разработки

### Критически важно (Оставшиеся 5% MVP):

1. **Финальное тестирование системы команд**

   - Полное тестирование всех сценариев передачи владения
   - Проверка работы с предопределенными цветами
   - Тестирование UI на разных устройствах и экранах
   - Валидация edge cases и error handling

2. **Push уведомления**

   - Система уведомлений о запросах передачи владения
   - Уведомления о принятии/отклонении передач
   - Интеграция с мобильными push-уведомлениями

3. **Оптимизация производительности**
   - Оптимизация рендеринга модальных окон
   - Улучшение производительности на слабых устройствах
   - Базовое кэширование данных команд

### Можно отложить на версию 2.0:

1. **Native карты для мобильных устройств**

   - Реализация react-native-maps для MapComponent
   - Отображение территорий как полигонов на карте
   - Интерактивные маркеры и захваты через карту

2. **Расширенный трекинг**

   - Трекинг маршрута бега с сохранением пути
   - Визуализация пройденного расстояния
   - История маршрутов пользователя

3. **Дополнительные функции**
   - Сложная геймификация
   - Партнерские заведения
   - Продвинутый чат команды
   - Сложные анимации
   - Полноценный оффлайн режим
   - Расширенная аналитика бега

## Временные рамки

**Общее время разработки MVP: 8-12 недель**

- ✅ Подготовка: 1-2 недели (завершено)
- ✅ Backend MVP: 2-3 недели (завершено)
- ✅ Frontend MVP: 2-3 недели (95% завершено - продвинутая система команд готова)
- ⚠️ Финальная полировка: 1-2 недели (native карты, уведомления)
- Real-time функции: ✅ Завершено (backend готов)
- Геолокация и карты: ⚠️ 1 неделя (улучшение трекинга)
- Оптимизация и тестирование: 1 неделя
- Деплой: 1 неделя

**Текущий статус:** Backend полностью готов, Frontend интеграция на 95% завершена включая продвинутую систему команд. Остается финальная полировка UI.

**Новая оценка времени до завершения MVP: 1-2 недели**

## Команда разработки

### Минимальная команда:

- 1 Fullstack разработчик (или Frontend + Backend)
- 1 UI/UX дизайнер (может быть на аутсорсе)

### Оптимальная команда:

- 1 Backend разработчик
- 1 React Native разработчик
- 1 UI/UX дизайнер
- 1 DevOps инженер (для деплоя)

## Следующие шаги

### Немедленные приоритеты (Финальная полировка):

1. **Тестирование системы команд**

   - Полное тестирование передачи владения команды
   - Проверка всех сценариев с предопределенными цветами
   - Валидация UI для разных размеров экрана
   - Тестирование edge cases в системе владения

2. **Push уведомления**

   - Уведомления о запросах передачи владения
   - Уведомления о принятии/отклонении передач
   - Уведомления о захватах территорий
   - Уведомления о командных достижениях

3. **Финальная оптимизация UI**

   - Улучшение анимаций в модальных окнах
   - Оптимизация производительности на мобильных устройствах
   - Базовый оффлайн режим для команд
   - Улучшенные индикаторы загрузки

4. **Подготовка к запуску**
   - Комплексное тестирование всех функций
   - Настройка production окружения
   - Подготовка документации
   - Beta-тестирование с реальными пользователями

### ✅ Уже реализованные критические функции:

- **Аутентификация:** Полная система регистрации, входа и управления профилем
- **Команды:** Создание, присоединение, управление с продвинутой системой владения
  - Передача владения с подтверждением
  - Предопределенные цвета команд
  - Настройки только для владельцев
  - Валидация выхода из команды
- **Территории:** Просмотр, поиск ближайших, система захватов
- **Бег:** Продвинутый трекинг с валидацией скорости и игровой механикой
- **API интеграция:** Все компоненты подключены к backend с обработкой ошибок
- **Состояние приложения:** Zustand stores с автоматической синхронизацией
- **Кроссплатформенность:** Web-версия для разработки, готовность к mobile
- **База данных:** Миграция team_ownership_transfers успешно применена

### Прогресс к готовому продукту: 🟢 95% MVP завершено!
